---
trigger: always_on
---

## Tech Stack & System Architecture

## Technology Stack (Strict)

- **Framework**: Next.js 15 (App Router).
- **Language**: TypeScript (Strict Mode). NO `any` allowed.
- **Database**: MongoDB Atlas (via Mongoose).
- **State Management**:
  - **Server**: `@tanstack/react-query` (Queries & Mutations).
  - **Client**: React Context (Global UI State).
- **Styling**: Tailwind CSS v4 + shadcn/ui.
  - **Animation**: `framer-motion` (Standard variants).
- **Validation**: Zod (Shared schemas in `src/shared/schemas`).
- **Auth**: Custom JWT via HttpOnly Cookies.

## Feature-Sliced Design (FSD) Structure

The project MUST follow this directory structure. Do not invent new root folders.

```text
src/
├── app/             # Entry points & API routes (Route Handlers)
│   ├── (auth)/      # Login/Signup views
│   ├── (finance)/   # Transaction, Analytics views
│   ├── (system)/    # Settings, Profile
│   └── api/v1/      # REST API
├── server/          # Backend Logic (3-Tier Arch)
│   ├── services/    # Business Logic (Singletons)
│   ├── repositories/# Database Access (Mongoose)
│   ├── mappers/     # Data Transformation
│   └── db/          # Mongoose Models
├── features/        # Feature-Specific UI (Components + Hooks)
├── lib/             # Shared Utilities (Logger, Fetcher)
├── shared/          # Universal Types & Constants
└── components/      # UI Library (shadcn)
```

## Backend Architecture (3-Tier)

**Request Lifecycle**: `Request → Proxy (JWT) → Service (Logic) → Repository (DB) → Mapper (Transform) → Response (JSON)`

1. **Repository Layer (`src/server/repositories`)**:

   - Singleton Pattern.
   - MUST call `await connect()` in every method.
   - Returns `Document` or `Domain Object` (via Mapper).
   - **Rule**: The only layer permitted to import Mongoose Models.

   1. **Service Layer (`src/server/services`)**:
      - Singleton Pattern.

   - Business logic & validation.
   - CALLS Mappers to convert DB Docs -> Domain Types.

   1. **API Layer (`src/app/api/v1`)**:

   - Route Handlers (`GET`, `POST`).
   - Orchestration: Authenticate -> Call Service -> Return JSON.
   - **Constraint**: NEVER import a Mongoose Model directly here.

   ## Frontend Architecture

   - **Components**:

- **Atomic**: `src/components/ui`.
- **Feature**: `src/features/{domain}/components`.
- **Data Fetching**: Use `@/lib/fetcher` (NO `axios`).
- **Hooks**: Use `useQuery` for reads, `useMutation` for writes.

---

## Naming Conventions & File Structure

## Code Naming Standards

| Entity         | Case              | Example                                |
| :------------- | :---------------- | :------------------------------------- |
| **Interfaces** | `IPascalCase`     | `ITransaction`, `IUserProfile`         |
| **Classes**    | `PascalCase`      | `TransactionService`, `AuthRepository` |
| **Components** | `PascalCase`      | `BalanceCard`, `SidebarNav`            |
| **Functions**  | `camelCase`       | `calculateTotal`, `fetchData`          |
| **Variables**  | `camelCase`       | `isValid`, `userList`                  |
| **Constants**  | `SCREAMING_SNAKE` | `MAX_RETRIES`, `DEFAULT_PAGE_SIZE`     |

## File & Directory Structure

- **Components**: `PascalCase.tsx` (e.g., `features/dashboard/components/BalanceCard.tsx`)
- **Hooks/Utils**: `camelCase.ts` (e.g., `lib/utils/formatDate.ts`)
- **Routes**: `kebab-case` (e.g., `app/api/v1/tax-report/route.ts`)
- **Tests**: `__tests__` folder or `*.test.ts`.

## API Standardization

- **Routes**: Use `kebab-case` in URLs.
- **Parameters**: Use `camelCase` for JSON keys and query params.
- **Dates**: Transmit as `ISO8601` strings (`YYYY-MM-DDTHH...`).
- **Response Shape**:

  ```typescript
  { success: boolean, data: T, meta?: object, error?: object }
  ```

  ## ID Handling (Strict)

  - **Shared Types (Frontend)**: `_id` and `userId` are `string`.

- **Mongoose Models (Backend)**: `_id` and `userId` are `Types.ObjectId`.
- **API Transport**: IDs are always serialized to `string`.

---
